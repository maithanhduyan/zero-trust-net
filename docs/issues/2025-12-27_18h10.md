Analyze project structure issues

Read [](file:///home/zero-trust-netwoking/control-plane/api/v1/admin.py#1-1), lines 1 to 150

Read [](file:///home/zero-trust-netwoking/control-plane/core/policy_engine.py#1-1), lines 1 to 150

Read [](file:///home/zero-trust-netwoking/policies/global.yaml#1-1), lines 1 to 100

Read [](file:///home/zero-trust-netwoking/policies)

Read [](file:///home/zero-trust-netwoking/control-plane/api/v1/admin.py#151-151), lines 151 to 300

Read [](file:///home/zero-trust-netwoking/policies/roles)

Read [](file:///home/zero-trust-netwoking/scripts)

Searched for regex `hub|control-plane|agent|node` (`**/scripts/**/*.sh`), 20 results

Read [](file:///home/zero-trust-netwoking/policies/roles/app.yaml#1-1), lines 1 to 100

Read [](file:///home/zero-trust-netwoking/policies/roles/database.yaml#1-1), lines 1 to 100

Read [](file:///home/zero-trust-netwoking/control-plane/api/v1/admin.py#301-301), lines 301 to 500

Read [](file:///home/zero-trust-netwoking/scripts/hub/install.sh#1-1), lines 1 to 100

Read [](file:///home/zero-trust-netwoking/scripts/node/install.sh#1-1), lines 1 to 100

Read [](file:///home/zero-trust-netwoking/scripts/policy/apply.sh#1-1), lines 1 to 100

Read [](file:///home/zero-trust-netwoking/control-plane/core/policy_engine.py#150-150), lines 150 to 304

Read [](file:///home/zero-trust-netwoking/control-plane/api/v1/admin.py#500-500), lines 500 to 700

Searched for regex `load.*yaml|parse.*policy|import.*policies`, 9 results

Read [](file:///home/zero-trust-netwoking/infrastructure/ansible/playbook/sync-policies.yml)

Read [](file:///home/zero-trust-netwoking/control-plane/api/v1/admin.py#700-700), lines 700 to 848

Read [](file:///home/zero-trust-netwoking/control-plane/api/v1/agent.py#1-1), lines 1 to 100

Searched for regex `control-plane|control_plane|hub` (`**/infrastructure/ansible/**/*.yml`), 20 results

Read [](file:///home/zero-trust-netwoking/control-plane/api/v1/agent.py#100-100), lines 100 to 250

Read [](file:///home/zero-trust-netwoking/infrastructure/ansible/roles)

Read [](file:///home/zero-trust-netwoking/infrastructure/ansible/inventory/group_vars)

Searched for regex `ztctl|cli|command.line|argparse`, 20 results

Read [](file:///home/zero-trust-netwoking/infrastructure/ansible/inventory/group_vars/agent.yml)

Read [](file:///home/zero-trust-netwoking/infrastructure/ansible/inventory/group_vars/hub.yml)

Read [](file:///home/zero-trust-netwoking/infrastructure/ansible/inventory/hosts.ini#1-1), lines 1 to 50

Read [](file:///home/zero-trust-netwoking/scripts/policy/apply.sh#100-100), lines 100 to 254

## Plan: Cải thiện Naming & Policy Management

### Phân tích vấn đề

**1. Naming Inconsistency hiện tại:**

| Vị trí | Dùng "hub/node" | Dùng "control-plane/agent" |
|--------|-----------------|---------------------------|
| Source code | ❌ | ✅ control-plane, agent |
| Scripts | ✅ `hub/`, `node/` | ❌ |
| Ansible | ✅ `[hub]` group | ✅ `roles/control-plane/` |
| Config | ✅ `hub` role | ✅ `agent.conf` |

**Khuyến nghị:** Thống nhất dùng `hub/` và `node/` vì:
- Ngắn gọn hơn
- Scripts đã dùng
- Phù hợp với WireGuard terminology (Hub-and-Spoke)

**2. Policy Management hiện tại:**
- ❌ Không có CLI tool
- ❌ Phải chờ 60s cho agent sync
- ❌ Không có giao diện
- ✅ Có API CRUD đầy đủ

---

### Steps

1. **Thống nhất naming** - Đổi tên thư mục source code:
   - control-plane → `hub/`
   - agent → `node/`
   - Cập nhật imports và references

2. **Tạo CLI tool `ztctl`** - Script để admin quản lý nhanh:
   - `ztctl policy list` - Liệt kê policies
   - `ztctl policy set allow app db --port 5432` - Cho phép app→db
   - `ztctl policy deny app db` - Chặn app→db
   - `ztctl node list` - Liệt kê nodes
   - `ztctl sync --force` - Trigger sync ngay lập tức

3. **Implement instant policy sync:**
   - Thêm API endpoint `/policies/sync` để trigger agent refresh
   - Giảm sync interval xuống 15 giây

4. **Optional: Web UI** (sau này):
   - Dashboard hiển thị nodes, connections
   - Drag-drop policy builder

---

### Further Considerations

1. **Rename source directories?**
   - **Option A**: Giữ nguyên control-plane và agent (ít thay đổi, nhưng không consistent)
   - **Option B**: Đổi thành `hub/` và `node/` (consistent nhưng cần update nhiều)
   - Khuyến nghị: **Option A** - Giữ nguyên vì đây là technical terms chuẩn, chỉ scripts mới dùng user-friendly terms

2. **CLI tool implementation:**
   - **Python** (sử dụng Click/Typer) - Integrate với existing code
   - **Bash** - Đơn giản, dùng curl gọi API
   - Khuyến nghị: **Bash** trước cho MVP, Python sau

3. **Policy change latency:** Chấp nhận 15-60s delay hay cần instant (<1s)?
   - WebSocket cần thêm complexity
   - 15s thường đủ cho production