D·ª±a tr√™n t√†i li·ªáu **NIST Special Publication 800-207: Zero Trust Architecture** m√† b·∫°n cung c·∫•p, d∆∞·ªõi ƒë√¢y l√† b·∫£n t√≥m t·∫Øt v√† h∆∞·ªõng d·∫´n thi·∫øt k·∫ø h·ªá th·ªëng **Zero Trust Networking (ZTA)**. T√†i li·ªáu n√†y ƒë∆∞·ª£c c·∫•u tr√∫c ƒë·ªÉ gi√∫p c√°c ki·∫øn tr√∫c s∆∞ b·∫£o m·∫≠t v√† qu·∫£n tr·ªã vi√™n h·ªá th·ªëng hi·ªÉu v√† l√™n k·∫ø ho·∫°ch tri·ªÉn khai.

---

# T√ÄI LI·ªÜU THI·∫æT K·∫æ KI·∫æN TR√öC ZERO TRUST (ZTA)
*(D·ª±a tr√™n chu·∫©n NIST SP 800-207)*

## 1. T·ªïng quan v√† ƒê·ªãnh nghƒ©a
**Zero Trust (ZT)** kh√¥ng ph·∫£i l√† m·ªôt c√¥ng ngh·ªá ƒë∆°n l·∫ª m√† l√† m·ªôt t·∫≠p h·ª£p c√°c nguy√™n t·∫Øc an ninh m·∫°ng. T∆∞ duy c·ªët l√µi l√† chuy·ªÉn d·ªãch t·ª´ vi·ªác b·∫£o v·ªá "bi√™n m·∫°ng" (network perimeter) tƒ©nh sang t·∫≠p trung b·∫£o v·ªá **ng∆∞·ªùi d√πng (users), t√†i s·∫£n (assets) v√† t√†i nguy√™n (resources)**.

*   **Nguy√™n l√Ω cƒÉn b·∫£n:** "Kh√¥ng bao gi·ªù tin t∆∞·ªüng, lu√¥n lu√¥n x√°c minh" (Never trust, always verify). Kh√¥ng c√≥ s·ª± tin t∆∞·ªüng ng·∫ßm ƒë·ªãnh (implicit trust) cho b·∫•t k·ª≥ t√†i s·∫£n hay t√†i kho·∫£n ng∆∞·ªùi d√πng n√†o ch·ªâ d·ª±a tr√™n v·ªã tr√≠ v·∫≠t l√Ω ho·∫∑c v·ªã tr√≠ m·∫°ng (v√≠ d·ª•: m·∫°ng LAN n·ªôi b·ªô hay Internet).

## 2. B·∫£y Nguy√™n t·∫Øc C·ªët l√µi c·ªßa Zero Trust (The 7 Tenets)
M·ªçi thi·∫øt k·∫ø ZTA ph·∫£i tu√¢n th·ªß 7 nguy√™n t·∫Øc sau:

1.  **T·∫•t c·∫£ d·ªØ li·ªáu v√† d·ªãch v·ª• t√≠nh to√°n ƒë·ªÅu l√† T√ÄI NGUY√äN:** Bao g·ªìm c·∫£ thi·∫øt b·ªã c√° nh√¢n (BYOD), thi·∫øt b·ªã IoT, v√† c√°c d·ªãch v·ª• ƒë√°m m√¢y (SaaS).
2.  **B·∫£o m·∫≠t m·ªçi giao ti·∫øp b·∫•t k·ªÉ v·ªã tr√≠ m·∫°ng:** Truy c·∫≠p t·ª´ m·∫°ng n·ªôi b·ªô c≈©ng ph·∫£i ƒë√°p ·ª©ng c√°c ti√™u chu·∫©n b·∫£o m·∫≠t kh·∫Øt khe nh∆∞ truy c·∫≠p t·ª´ b√™n ngo√†i (m√£ h√≥a, x√°c th·ª±c).
3.  **Truy c·∫≠p t√†i nguy√™n ƒë∆∞·ª£c c·∫•p theo t·ª´ng PHI√äN (Per-session):** S·ª± tin t∆∞·ªüng ƒë∆∞·ª£c ƒë√°nh gi√° l·∫°i tr∆∞·ªõc m·ªói k·∫øt n·ªëi. Vi·ªác x√°c th·ª±c v√†o m·∫°ng kh√¥ng ƒë·ªìng nghƒ©a v·ªõi vi·ªác ƒë∆∞·ª£c quy·ªÅn truy c·∫≠p v√†o ·ª©ng d·ª•ng.
4.  **Truy c·∫≠p ƒë∆∞·ª£c quy·∫øt ƒë·ªãnh b·ªüi CH√çNH S√ÅCH ƒê·ªòNG (Dynamic Policy):** Quy·∫øt ƒë·ªãnh c·∫•p quy·ªÅn d·ª±a tr√™n:
    *   Danh t√≠nh ƒë·ªëi t∆∞·ª£ng (User ID).
    *   Tr·∫°ng th√°i thi·∫øt b·ªã (Device health/posture).
    *   H√†nh vi ng∆∞·ªùi d√πng.
    *   M√¥i tr∆∞·ªùng (Th·ªùi gian, v·ªã tr√≠ ƒë·ªãa l√Ω).
5.  **Gi√°m s√°t v√† ƒëo l∆∞·ªùng tr·∫°ng th√°i an ninh c·ªßa m·ªçi t√†i s·∫£n:** Kh√¥ng c√≥ thi·∫øt b·ªã n√†o l√† tin c·∫≠y tuy·ªát ƒë·ªëi. H·ªá th·ªëng ph·∫£i li√™n t·ª•c qu√©t l·ªó h·ªïng v√† tr·∫°ng th√°i b·∫£n v√° (CDM).
6.  **X√°c th·ª±c v√† ·ªßy quy·ªÅn li√™n t·ª•c:** S·ª≠ d·ª•ng ƒêa y·∫øu t·ªë x√°c th·ª±c (MFA) v√† ki·ªÉm tra l·∫°i li√™n t·ª•c trong su·ªët qu√° tr√¨nh k·∫øt n·ªëi, kh√¥ng ch·ªâ t·∫°i th·ªùi ƒëi·ªÉm ƒëƒÉng nh·∫≠p.
7.  **Thu th·∫≠p th√¥ng tin ƒë·ªÉ c·∫£i thi·ªán b·∫£o m·∫≠t:** D√πng d·ªØ li·ªáu m·∫°ng, log truy c·∫≠p ƒë·ªÉ ph√¢n t√≠ch v√† t·ªëi ∆∞u h√≥a ch√≠nh s√°ch b·∫£o m·∫≠t.

## 3. C√°c Th√†nh ph·∫ßn Logic trong Ki·∫øn tr√∫c (Logical Components)

H·ªá th·ªëng ZTA ƒë∆∞·ª£c chia l√†m hai ph·∫ßn: **Control Plane** (M·∫∑t ph·∫≥ng ƒëi·ªÅu khi·ªÉn) v√† **Data Plane** (M·∫∑t ph·∫≥ng d·ªØ li·ªáu).

### A. Core Components (Th√†nh ph·∫ßn c·ªët l√µi)
1.  **Policy Engine (PE - B·ªô m√°y ch√≠nh s√°ch):** "B·ªô n√£o" c·ªßa h·ªá th·ªëng. Ch·ªãu tr√°ch nhi·ªám ra quy·∫øt ƒë·ªãnh (Cho ph√©p/T·ª´ ch·ªëi) d·ª±a tr√™n ch√≠nh s√°ch v√† thu·∫≠t to√°n tin c·∫≠y (Trust Algorithm).
2.  **Policy Administrator (PA - Qu·∫£n tr·ªã ch√≠nh s√°ch):** Ng∆∞·ªùi th·ª±c thi quy·∫øt ƒë·ªãnh c·ªßa PE. PA s·∫Ω ra l·ªánh t·∫°o ho·∫∑c ng·∫Øt k·∫øt n·ªëi.
3.  **Policy Enforcement Point (PEP - ƒêi·ªÉm th·ª±c thi ch√≠nh s√°ch):** C·ªïng k·∫øt n·ªëi (Gateway/Agent). ƒê√¢y l√† n∆°i duy nh·∫•t lu·ªìng d·ªØ li·ªáu ƒëi qua. PEP ch·∫∑n m·ªçi truy c·∫≠p cho ƒë·∫øn khi PA cho ph√©p.

### B. Input Data Sources (Ngu·ªìn d·ªØ li·ªáu ƒë·∫ßu v√†o cho PE)
ƒê·ªÉ PE ra quy·∫øt ƒë·ªãnh ch√≠nh x√°c, c·∫ßn t√≠ch h·ª£p d·ªØ li·ªáu t·ª´:
*   **CDM System:** Tr·∫°ng th√°i s·ª©c kh·ªèe thi·∫øt b·ªã.
*   **Threat Intelligence:** Th√¥ng tin v·ªÅ c√°c m·ªëi ƒëe d·ªça m·ªõi nh·∫•t.
*   **ID Management:** H·ªá th·ªëng qu·∫£n l√Ω danh t√≠nh (LDAP, AD).
*   **SIEM:** Nh·∫≠t k√Ω ho·∫°t ƒë·ªông v√† s·ª± ki·ªán b·∫£o m·∫≠t.

## 4. C√°c M√¥ h√¨nh Tri·ªÉn khai Ph·ªï bi·∫øn (Deployment Variations)

T√πy thu·ªôc v√†o h·∫° t·∫ßng hi·ªán c√≥, b·∫°n c√≥ th·ªÉ ch·ªçn m·ªôt trong c√°c m√¥ h√¨nh sau:

1.  **Device Agent/Gateway-Based:**
    *   C√†i ƒë·∫∑t Agent tr√™n thi·∫øt b·ªã ng∆∞·ªùi d√πng v√† Gateway tr∆∞·ªõc t√†i nguy√™n.
    *   Ph√π h·ª£p nh·∫•t cho doanh nghi·ªáp ki·ªÉm so√°t ch·∫∑t ch·∫Ω thi·∫øt b·ªã (Enterprise-owned devices).
2.  **Enclave-Based:**
    *   Gateway ƒë·∫∑t tr∆∞·ªõc m·ªôt nh√≥m t√†i nguy√™n (v√≠ d·ª•: m·ªôt trung t√¢m d·ªØ li·ªáu c≈© - Legacy DC).
    *   Ph√π h·ª£p cho c√°c h·ªá th·ªëng c≈© kh√¥ng h·ªó tr·ª£ c√†i ƒë·∫∑t Agent tr·ª±c ti·∫øp.
3.  **Resource Portal-Based:**
    *   Gateway ƒë√≥ng vai tr√≤ l√† m·ªôt c·ªïng web (Portal). Ng∆∞·ªùi d√πng truy c·∫≠p qua tr√¨nh duy·ªát.
    *   Ph√π h·ª£p cho BYOD ho·∫∑c ƒë·ªëi t√°c b√™n ngo√†i (Contractors) m√† kh√¥ng c·∫ßn c√†i Agent.
4.  **Application Sandboxing:**
    *   Ch·∫°y ·ª©ng d·ª•ng trong c√°c container/m√°y ·∫£o c√¥ l·∫≠p tr√™n thi·∫øt b·ªã.

## 5. Thu·∫≠t to√°n Tin c·∫≠y (Trust Algorithm)
Quy·∫øt ƒë·ªãnh truy c·∫≠p d·ª±a tr√™n c√¥ng th·ª©c:
`Truy c·∫≠p = f(Ng∆∞·ªùi d√πng, Thi·∫øt b·ªã, Ng·ªØ c·∫£nh, M·ª©c ƒë·ªô nh·∫°y c·∫£m c·ªßa d·ªØ li·ªáu)`

*   **Criteria-based:** D·ª±a tr√™n ti√™u ch√≠ c·ª©ng (V√≠ d·ª•: Ph·∫£i thu·ªôc nh√≥m Admin V√Ä thi·∫øt b·ªã ƒë√£ update Windows m·ªõi nh·∫•t).
*   **Score-based:** T√≠nh ƒëi·ªÉm tin c·∫≠y (Confidence Score). N·∫øu ƒëi·ªÉm > ng∆∞·ª°ng quy ƒë·ªãnh -> Cho ph√©p.

## 6. L·ªô tr√¨nh Chuy·ªÉn ƒë·ªïi sang ZTA (Migration Roadmap)

Vi·ªác chuy·ªÉn ƒë·ªïi kh√¥ng th·ªÉ di·ªÖn ra trong m·ªôt s·ªõm m·ªôt chi·ªÅu. NIST ƒë·ªÅ xu·∫•t quy tr√¨nh sau:

1.  **X√°c ƒë·ªãnh ƒê·ªëi t∆∞·ª£ng (Actors):** Ai l√† nh√¢n vi√™n, ai l√† ƒë·ªëi t√°c, c√°c t√†i kho·∫£n d·ªãch v·ª• (non-person entities).
2.  **X√°c ƒë·ªãnh T√†i s·∫£n (Assets):** Ki·ªÉm k√™ to√†n b·ªô thi·∫øt b·ªã v√† d·ªØ li·ªáu (Data classification).
3.  **X√°c ƒë·ªãnh Quy tr√¨nh nghi·ªáp v·ª• (Business Processes):** Ch·ªçn m·ªôt quy tr√¨nh √≠t r·ªßi ro ƒë·ªÉ th·ª≠ nghi·ªám tr∆∞·ªõc.
4.  **X√¢y d·ª±ng Ch√≠nh s√°ch (Formulating Policies):** Ai ƒë∆∞·ª£c truy c·∫≠p c√°i g√¨, trong ƒëi·ªÅu ki·ªán n√†o? (Whitelist approach).
5.  **L·ª±a ch·ªçn Gi·∫£i ph√°p (Identifying Solutions):** Ch·ªçn c√¥ng ngh·ªá ph√π h·ª£p (SDP, Micro-segmentation, Identity-aware proxy...).
6.  **Tri·ªÉn khai ban ƒë·∫ßu & Gi√°m s√°t (Initial Deployment):** Ch·∫°y ·ªü ch·∫ø ƒë·ªô "Ch·ªâ theo d√µi" (Audit/Log only) ƒë·ªÉ tinh ch·ªânh ch√≠nh s√°ch, tr√°nh l√†m gi√°n ƒëo·∫°n c√¥ng vi·ªác.
7.  **M·ªü r·ªông (Expanding):** √Åp d·ª•ng ch·∫ø ƒë·ªô th·ª±c thi (Enforcement) v√† m·ªü r·ªông sang c√°c quy tr√¨nh nghi·ªáp v·ª• kh√°c.

## 7. C√°c M·ªëi ƒëe d·ªça & R·ªßi ro
Khi tri·ªÉn khai ZTA, c·∫ßn l∆∞u √Ω:
*   **T·∫•n c√¥ng v√†o Control Plane (PE/PA):** N·∫øu PE/PA b·ªã chi·∫øm quy·ªÅn ho·∫∑c b·ªã DDoS, to√†n b·ªô ho·∫°t ƒë·ªông truy c·∫≠p s·∫Ω b·ªã t√™ li·ªát. C·∫ßn b·∫£o v·ªá k·ªπ l∆∞·ª°ng c√°c th√†nh ph·∫ßn n√†y.
*   **ƒê√°nh c·∫Øp t√†i kho·∫£n (Stolen Credentials):** ZTA gi·∫£m thi·ªÉu r·ªßi ro n√†y b·∫±ng MFA v√† Trust Algorithm ng·ªØ c·∫£nh (v√≠ d·ª•: ph√°t hi·ªán h√†nh vi b·∫•t th∆∞·ªùng d√π ƒë√∫ng m·∫≠t kh·∫©u), nh∆∞ng kh√¥ng lo·∫°i b·ªè ho√†n to√†n.
*   **Ph·ª• thu·ªôc v√†o nh√† cung c·∫•p (Vendor Lock-in):** Do thi·∫øu c√°c ti√™u chu·∫©n giao ti·∫øp chung gi·ªØa c√°c th√†nh ph·∫ßn ZT.

---
*T√†i li·ªáu n√†y t√≥m t·∫Øt c√°c ƒëi·ªÉm ch√≠nh y·∫øu t·ª´ NIST SP 800-207 ƒë·ªÉ h·ªó tr·ª£ vi·ªác thi·∫øt k·∫ø h·ªá th·ªëng b·∫£o m·∫≠t hi·ªán ƒë·∫°i.*
D·ª±a tr√™n nguy√™n l√Ω **NIST SP 800-207** v√† y√™u c·∫ßu t·ª± ch·ªß (Self-hosted Custom WireGuard) m√† b·∫°n ƒë√£ ch·ªçn, ƒë√¢y l√† c·∫•u tr√∫c th∆∞ m·ª•c chu·∫©n cho d·ª± √°n `zero-trust-networking`.

C·∫•u tr√∫c n√†y ƒë∆∞·ª£c thi·∫øt k·∫ø theo m√¥ h√¨nh **Monorepo** ƒë·ªÉ d·ªÖ qu·∫£n l√Ω phi√™n b·∫£n ƒë·ªìng nh·∫•t gi·ªØa Control Plane (Server) v√† Agent (Client).

### C·∫•u tr√∫c th∆∞ m·ª•c t·ªïng qu√°t

```text
zero-trust-networking/
‚îú‚îÄ‚îÄ control-plane/           # (N√ÉO B·ªò) Server qu·∫£n l√Ω trung t√¢m
‚îÇ   ‚îú‚îÄ‚îÄ api/                 # Interface giao ti·∫øp v·ªõi Agent v√† Admin
‚îÇ   ‚îú‚îÄ‚îÄ core/                # Logic nghi·ªáp v·ª• c·ªët l√µi
‚îÇ   ‚îú‚îÄ‚îÄ database/            # L∆∞u tr·ªØ tr·∫°ng th√°i (Postgres/SQLite)
‚îÇ   ‚îú‚îÄ‚îÄ policy-engine/       # (PDP) N∆°i ra quy·∫øt ƒë·ªãnh Trust Algorithm
‚îÇ   ‚îî‚îÄ‚îÄ web-ui/              # (Optional) Dashboard qu·∫£n tr·ªã
‚îÇ
‚îú‚îÄ‚îÄ agent/                   # (TAY CH√ÇN) Ch·∫°y tr√™n t·ª´ng VPS/Client
‚îÇ   ‚îú‚îÄ‚îÄ core/                # Logic k·∫øt n·ªëi API, Heartbeat
‚îÇ   ‚îú‚îÄ‚îÄ wireguard/           # Qu·∫£n l√Ω Interface WG, Key pair
‚îÇ   ‚îî‚îÄ‚îÄ firewall/            # (PEP) Qu·∫£n l√Ω iptables/nftables
‚îÇ
‚îú‚îÄ‚îÄ policies/                # (LU·∫¨T) ƒê·ªãnh nghƒ©a Policy-as-Code
‚îÇ   ‚îú‚îÄ‚îÄ access-control/      # Ai ƒë∆∞·ª£c g·∫∑p ai (ACLs)
‚îÇ   ‚îî‚îÄ‚îÄ compliance/          # Y√™u c·∫ßu v·ªÅ OS, version...
‚îÇ
‚îú‚îÄ‚îÄ infrastructure/          # (C∆† B·∫ÆP) Automation & Deployment
‚îÇ   ‚îú‚îÄ‚îÄ ansible/             # Playbooks c√†i ƒë·∫∑t (nh∆∞ ƒë√£ b√†n ·ªü tr√™n)
‚îÇ   ‚îú‚îÄ‚îÄ docker/              # Dockerfile cho Control Plane
‚îÇ   ‚îî‚îÄ‚îÄ scripts/             # Helper scripts (keygen, bootstrap)
‚îÇ
‚îú‚îÄ‚îÄ docs/                    # T√†i li·ªáu ki·∫øn tr√∫c & v·∫≠n h√†nh
‚îú‚îÄ‚îÄ tests/                   # E2E Testing
‚îú‚îÄ‚îÄ docker-compose.yml       # Dev environment
‚îú‚îÄ‚îÄ Makefile                 # Shortcuts l·ªánh
‚îî‚îÄ‚îÄ README.md
```

---

### Chi ti·∫øt t·ª´ng th√†nh ph·∫ßn (Deep Dive)

#### 1. `control-plane/` (Policy Administrator - PA)
ƒê√¢y l√† n∆°i ch·ª©a API server. N√≥ **kh√¥ng** x·ª≠ l√Ω g√≥i tin d·ªØ li·ªáu (Data Plane), n√≥ ch·ªâ ph√¢n ph·ªëi c·∫•u h√¨nh.

```text
control-plane/
‚îú‚îÄ‚îÄ main.py                  # Entrypoint (FastAPI/Go)
‚îú‚îÄ‚îÄ config.py                # Load bi·∫øn m√¥i tr∆∞·ªùng
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ v1/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ endpoints.py     # /register, /sync, /heartbeat
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin.py         # API cho ng∆∞·ªùi qu·∫£n tr·ªã
‚îÇ   ‚îî‚îÄ‚îÄ dependencies.py      # Auth middleware (mTLS/Token)
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ key_manager.py       # Qu·∫£n l√Ω Public Keys
‚îÇ   ‚îî‚îÄ‚îÄ ipam.py              # C·∫•p ph√°t IP ·∫£o (10.10.0.x)
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ models.py            # Node, Peer, Policy tables
‚îÇ   ‚îî‚îÄ‚îÄ migrations/          # Alembic/SQL migration scripts
‚îî‚îÄ‚îÄ policy-engine/           # QUAN TR·ªåNG NH·∫§T
    ‚îú‚îÄ‚îÄ evaluator.py         # H√†m t√≠nh ƒëi·ªÉm tin c·∫≠y (Trust Score)
    ‚îî‚îÄ‚îÄ compiler.py          # Chuy·ªÉn Policy -> WireGuard Config + IPTables
```

*   **ƒêi·ªÉm nh·∫•n:** Module `policy-engine` t√°ch bi·ªát. Khi API nh·∫≠n request t·ª´ Agent, n√≥ ph·∫£i h·ªèi `policy-engine` tr∆∞·ªõc khi tr·∫£ v·ªÅ config.

#### 2. `agent/` (Policy Enforcement Point - PEP)
Ch·∫°y tr√™n m·ªói VPS (Odoo, Postgres, Ops). N√≥ ph·∫£i c·ª±c nh·∫π v√† ·ªïn ƒë·ªãnh.

```text
agent/
‚îú‚îÄ‚îÄ agent.py                 # Main loop (Scheduler)
‚îú‚îÄ‚îÄ client.py                # HTTP Client g·ªçi v·ªÅ Control Plane (mTLS)
‚îú‚îÄ‚îÄ wireguard/
‚îÇ   ‚îú‚îÄ‚îÄ manager.py           # G·ªçi l·ªánh `wg`, `wg-quick`
‚îÇ   ‚îî‚îÄ‚îÄ config_builder.py    # T·∫°o file wg0.conf t·ª´ JSON
‚îú‚îÄ‚îÄ firewall/
‚îÇ   ‚îú‚îÄ‚îÄ iptables.py          # Wrapper l·ªánh iptables
‚îÇ   ‚îî‚îÄ‚îÄ nftables.py          # (Future proof)
‚îî‚îÄ‚îÄ collectors/              # Thu th·∫≠p th√¥ng tin cho Trust Algorithm
    ‚îú‚îÄ‚îÄ host_info.py         # L·∫•y OS version, uptime
    ‚îî‚îÄ‚îÄ network_stats.py     # L·∫•y th√¥ng tin traffic
```

*   **ƒêi·ªÉm nh·∫•n:** `firewall` module l√† n∆°i th·ª±c thi Zero Trust. N·∫øu Control Plane b·∫£o "C·∫•m", module n√†y s·∫Ω `DROP` g√≥i tin ngay t·∫°i m√°y, tr∆∞·ªõc khi n√≥ v√†o ƒë·∫øn ·ª©ng d·ª•ng.

#### 3. `policies/` (Policy as Code)
Thay v√¨ l∆∞u c·ª©ng trong Database, policy n√™n ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b·∫±ng code (YAML/JSON) ƒë·ªÉ c√≥ th·ªÉ Review v√† Version Control.

```text
policies/
‚îú‚îÄ‚îÄ global.yaml              # Policy m·∫∑c ƒë·ªãnh (VD: Deny All)
‚îú‚îÄ‚îÄ roles/
‚îÇ   ‚îú‚îÄ‚îÄ database.yaml        # Role: Postgres (Allow port 5432 from App)
‚îÇ   ‚îú‚îÄ‚îÄ app.yaml             # Role: Odoo (Allow outbound to DB)
‚îÇ   ‚îî‚îÄ‚îÄ ops.yaml             # Role: Admin (Allow SSH)
‚îî‚îÄ‚îÄ users/
    ‚îî‚îÄ‚îÄ admin-team.yaml      # Mapping user -> role
```

*   **Logic:** Control Plane s·∫Ω ƒë·ªçc c√°c file n√†y khi kh·ªüi ƒë·ªông ho·∫∑c khi c√≥ trigger reload ƒë·ªÉ c·∫≠p nh·∫≠t v√†o Database/Memory.

#### 4. `infrastructure/` (Ansible & Deployment)
N∆°i ch·ª©a code ƒë·ªÉ tri·ªÉn khai h·ªá th·ªëng n√†y ra 4 VPS th·ª±c t·∫ø.

```text
infrastructure/
‚îú‚îÄ‚îÄ ansible/
‚îÇ   ‚îú‚îÄ‚îÄ inventory/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ hosts.ini
‚îÇ   ‚îú‚îÄ‚îÄ roles/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ common/          # C√†i Python, Docker
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ control-plane/   # Deploy Docker container Control Plane
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ agent/           # C√†i Systemd service cho Agent
‚îÇ   ‚îî‚îÄ‚îÄ deploy-site.yml
‚îî‚îÄ‚îÄ docker/
    ‚îî‚îÄ‚îÄ Dockerfile.control   # Image cho Control Plane
```

---

### Workflow ho·∫°t ƒë·ªông (V√≠ d·ª•)

1.  **Kh·ªüi t·∫°o:**
    *   B·∫°n ƒë·ªãnh nghƒ©a file `policies/roles/database.yaml`: *Ch·ªâ cho ph√©p `role:app` k·∫øt n·ªëi port `5432`*.
    *   B·∫°n ch·∫°y `ansible` ƒë·ªÉ deploy Control Plane l√™n VPS-1 v√† Agent l√™n VPS-2 (App), VPS-3 (DB).

2.  **ƒêƒÉng k√Ω (Registration):**
    *   Agent t·∫°i VPS-3 (DB) kh·ªüi ƒë·ªông, sinh Key, g·ªçi API `/register` v·ªõi th√¥ng tin `role: database`.
    *   Control Plane l∆∞u th√¥ng tin, ch∆∞a c·∫•p quy·ªÅn ngay (Pending Approval).

3.  **C·∫•p ph√©p (Trust Evaluation):**
    *   B·∫°n (Admin) approve node VPS-3.
    *   `policy-engine` t√≠nh to√°n: Node n√†y l√† DB, v·∫≠y n√≥ c·∫ßn m·ªü port 5432 cho ai? -> Cho `role: app`.

4.  **ƒê·ªìng b·ªô (Synchronization):**
    *   Agent t·∫°i VPS-3 g·ªçi `/sync`.
    *   Control Plane tr·∫£ v·ªÅ:
        *   WireGuard Peer: VPS-1 (Hub), VPS-2 (App).
        *   Firewall Rule: `ALLOW TCP 5432 FROM 10.10.0.2 (VPS-2 IP)`.
    *   Agent t·∫°i VPS-3 apply config n√†y.

K·∫øt qu·∫£: **Zero Trust ƒë·∫°t ƒë∆∞·ª£c.** VPS-2 th·∫•y VPS-3 qua tunnel, nh∆∞ng ch·ªâ v√†o ƒë∆∞·ª£c port 5432. SSH (port 22) b·ªã ch·∫∑n b·ªüi iptables do Agent qu·∫£n l√Ω (tr·ª´ khi policy cho ph√©p).
---

ƒê√¢y l√† script `install.sh` ƒë·ªÉ kh·ªüi t·∫°o c·∫•u tr√∫c d·ª± √°n **Zero Trust Networking**.

Script n√†y kh√¥ng ch·ªâ t·∫°o th∆∞ m·ª•c r·ªóng, m√† c√≤n **t·ª± ƒë·ªông sinh m√£ ngu·ªìn m·∫´u (boilerplate code)** cho API (FastAPI), Agent (Python), Policy (YAML) v√† Ansible ƒë·ªÉ b·∫°n c√≥ th·ªÉ b·∫Øt ƒë·∫ßu code logic ngay l·∫≠p t·ª©c.

### N·ªôi dung file `install.sh`

```bash
#!/bin/bash

# ==============================================================================
#  ZERO TRUST PROJECT SCAFFOLDING SCRIPT
#  ----------------------------------------------------------------------------
#  M·ª•c ti√™u: Kh·ªüi t·∫°o c·∫•u tr√∫c Monorepo chu·∫©n NIST SP 800-207
#  Bao g·ªìm: Control Plane (FastAPI), Agent, Policy-as-Code, Infrastructure
# ==============================================================================

set -e

# --- C·∫§U H√åNH ---
PROJECT_NAME="zero-trust-networking"
CURRENT_DIR=$(pwd)
TARGET_DIR="$CURRENT_DIR/$PROJECT_NAME"

# M√†u s·∫Øc
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m'

# --- H√ÄM H·ªñ TR·ª¢ ---
log() { echo -e "${BLUE}[INFO]${NC} $1"; }
success() { echo -e "${GREEN}[DONE]${NC} $1"; }

create_file() {
    local path="$1"
    local content="$2"
    if [ ! -f "$path" ]; then
        echo "$content" > "$path"
    fi
}

# --- B·∫ÆT ƒê·∫¶U ---

if [ -d "$TARGET_DIR" ]; then
    echo "Th∆∞ m·ª•c $PROJECT_NAME ƒë√£ t·ªìn t·∫°i. B·∫°n c√≥ mu·ªën ti·∫øp t·ª•c? (y/n)"
    read -r response
    if [[ "$response" != "y" ]]; then exit 1; fi
fi

mkdir -p "$TARGET_DIR"
cd "$TARGET_DIR"

log "1. Kh·ªüi t·∫°o c·∫•u tr√∫c Control Plane (The Brain)..."
mkdir -p control-plane/{api/v1,core,database/migrations,policy-engine,tests}
touch control-plane/__init__.py

# T·∫°o file main.py m·∫´u cho Control Plane
create_file "control-plane/main.py" "from fastapi import FastAPI
from api.v1 import endpoints

app = FastAPI(title='Zero Trust Control Plane', version='1.0.0')

app.include_router(endpoints.router, prefix='/api/v1')

@app.get('/health')
def health_check():
    return {'status': 'active', 'component': 'control-plane'}"

# T·∫°o file endpoints m·∫´u
create_file "control-plane/api/v1/endpoints.py" "from fastapi import APIRouter

router = APIRouter()

@router.post('/register')
def register_node(node_data: dict):
    # TODO: Call Policy Engine here
    return {'status': 'pending_approval', 'node_id': 'tmp-123'}"

# T·∫°o file Policy Engine m·∫´u
create_file "control-plane/policy-engine/evaluator.py" "class TrustEvaluator:
    def evaluate(self, subject, resource, context):
        # NIST SP 800-207 Trust Algorithm
        score = 0
        # Logic t√≠nh ƒëi·ªÉm tin c·∫≠y
        return score >= 80"

create_file "control-plane/requirements.txt" "fastapi
uvicorn
sqlalchemy
alembic
pydantic
psycopg2-binary"

log "2. Kh·ªüi t·∫°o c·∫•u tr√∫c Agent (The Muscles)..."
mkdir -p agent/{core,wireguard,firewall,collectors,tests}
touch agent/__init__.py

# T·∫°o file agent.py m·∫´u
create_file "agent/agent.py" "import time
import logging

class ZeroTrustAgent:
    def __init__(self):
        self.node_id = None
    
    def heartbeat(self):
        # G·ª≠i th√¥ng tin v·ªÅ Control Plane
        pass

    def run(self):
        logging.info('Agent starting...')
        while True:
            self.heartbeat()
            time.sleep(60)

if __name__ == '__main__':
    ZeroTrustAgent().run()"

# T·∫°o module firewall m·∫´u
create_file "agent/firewall/iptables.py" "import subprocess

def apply_rule(src_ip, port, proto='tcp'):
    cmd = f'iptables -A INPUT -s {src_ip} -p {proto} --dport {port} -j ACCEPT'
    # subprocess.run(cmd, shell=True)"

create_file "agent/requirements.txt" "requests
schedule
psutil
netifaces"

log "3. Kh·ªüi t·∫°o c·∫•u tr√∫c Policies (The Law)..."
mkdir -p policies/{roles,global,users}

# T·∫°o Policy m·∫´u cho Database
create_file "policies/roles/database.yaml" "kind: Role
metadata:
  name: postgres-primary
  tags:
    - tag:db
    - tag:prod
spec:
  inbound:
    - port: 5432
      protocol: tcp
      allow_from:
        - role: odoo-app
  compliance:
    os: ubuntu-22.04
    encryption: required"

# T·∫°o Policy m·∫´u cho App
create_file "policies/roles/app.yaml" "kind: Role
metadata:
  name: odoo-app
spec:
  outbound:
    - role: postgres-primary"

log "4. Kh·ªüi t·∫°o Infrastructure (Automation)..."
mkdir -p infrastructure/ansible/{inventory,roles,playbooks}
mkdir -p infrastructure/docker
mkdir -p infrastructure/scripts

# T·∫°o Dockerfile cho Control Plane
create_file "infrastructure/docker/Dockerfile.control" "FROM python:3.10-slim
WORKDIR /app
COPY control-plane/requirements.txt .
RUN pip install -r requirements.txt
COPY control-plane .
CMD [\"uvicorn\", \"main:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8000\"]"

# T·∫°o Ansible Inventory m·∫´u
create_file "infrastructure/ansible/inventory/hosts.ini" "[control_plane]
vps-1

[agents]
vps-2
vps-3
vps-4"

log "5. T·∫°o c√°c file c·∫•u h√¨nh g·ªëc..."
create_file "README.md" "# Zero Trust Networking Platform

## Architecture
- **Control Plane**: FastAPI (Decision Point)
- **Agent**: Python + WireGuard (Enforcement Point)
- **Policy**: YAML based

## Quick Start
1. Run \`make install\`
2. Run \`make up\`"

create_file "Makefile" "install:
	pip install -r control-plane/requirements.txt
	pip install -r agent/requirements.txt

up:
	docker-compose up -d

test:
	pytest"

# T·∫°o docker-compose ƒë·ªÉ dev local
create_file "docker-compose.yml" "version: '3.8'
services:
  control-plane:
    build:
      context: .
      dockerfile: infrastructure/docker/Dockerfile.control
    ports:
      - '8000:8000'
    volumes:
      - ./control-plane:/app
    environment:
      - DB_URL=postgresql://user:pass@db:5432/zt_db

  db:
    image: postgres:15-alpine
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: pass
      POSTGRES_DB: zt_db"

success "D·ª± √°n ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o t·∫°i: $TARGET_DIR"
echo "--------------------------------------------------------"
echo "B∆∞·ªõc ti·∫øp theo:"
echo "1. cd $PROJECT_NAME"
echo "2. Kh√°m ph√° c·∫•u tr√∫c th∆∞ m·ª•c"
echo "3. B·∫Øt ƒë·∫ßu code logic t·∫°i control-plane/policy-engine/"
echo "--------------------------------------------------------"
```

### C√°ch s·ª≠ d·ª•ng

1.  L∆∞u ƒëo·∫°n m√£ tr√™n v√†o file `install.sh`.
2.  C·∫•p quy·ªÅn th·ª±c thi:
    ```bash
    chmod +x install.sh
    ```
3.  Ch·∫°y script t·∫°i th∆∞ m·ª•c b·∫°n mu·ªën ch·ª©a d·ª± √°n:
    ```bash
    ./install.sh
    ```

### K·∫øt qu·∫£ b·∫°n nh·∫≠n ƒë∆∞·ª£c
Sau khi ch·∫°y, b·∫°n s·∫Ω c√≥ ngay m·ªôt d·ª± √°n **ƒë·ªß ti√™u chu·∫©n** ƒë·ªÉ b·∫Øt ƒë·∫ßu ph√°t tri·ªÉn, kh√¥ng ph·∫£i lo nghƒ© v·ªÅ vi·ªác ƒë·∫∑t file ·ªü ƒë√¢u.

*   **`control-plane/`**: ƒê√£ c√≥ s·∫µn FastAPI server ch·∫°y ƒë∆∞·ª£c ngay.
*   **`agent/`**: ƒê√£ c√≥ khung s∆∞·ªùn cho Agent ch·∫°y ng·∫ßm.
*   **`policies/`**: ƒê√£ c√≥ v√≠ d·ª• v·ªÅ Role-based policy (Odoo ƒë∆∞·ª£c g·ªçi Postgres).
*   **`infrastructure/`**: ƒê√£ c√≥ Dockerfile v√† Ansible inventory.

ƒê√¢y l√† **b·ªô khung "x∆∞∆°ng s·ªëng"** (Skeleton) v·ªØng ch·∫Øc nh·∫•t ƒë·ªÉ b·∫°n x√¢y d·ª±ng h·ªá th·ªëng Zero Trust t·ª± ch·ªß.

---
ƒê·ªÉ ng∆∞·ªùi d√πng c√≥ th·ªÉ c√†i ƒë·∫∑t **Control Plane** l√™n Ubuntu m·ªôt c√°ch nhanh nh·∫•t (th∆∞·ªùng g·ªçi l√† "One-click install" ho·∫∑c "Zero-touch setup"), b·∫°n c·∫ßn ƒë√≥ng g√≥i quy tr√¨nh c√†i ƒë·∫∑t v√†o m·ªôt **Bash Script** duy nh·∫•t.

Script n√†y s·∫Ω th·ª±c hi·ªán 3 nhi·ªám v·ª•:
1.  **C√†i ƒë·∫∑t Dependencies** (Docker, Docker Compose).
2.  **C·∫•u h√¨nh M√¥i tr∆∞·ªùng** (T·∫°o file `.env`, sinh m·∫≠t kh·∫©u ng·∫´u nhi√™n).
3.  **Tri·ªÉn khai** (Build Docker image v√† ch·∫°y container).

D∆∞·ªõi ƒë√¢y l√† c√°c b∆∞·ªõc th·ª±c hi·ªán chi ti·∫øt ƒë·ªÉ t√≠ch h·ª£p v√†o repo c·ªßa b·∫°n.

---

### B∆∞·ªõc 1: Chu·∫©n b·ªã file `docker-compose.prod.yml`

Trong th∆∞ m·ª•c g·ªëc c·ªßa d·ª± √°n, b·∫°n c·∫ßn m·ªôt file docker-compose d√†nh ri√™ng cho m√¥i tr∆∞·ªùng Production (kh√°c v·ªõi file dev b·∫°n ƒëang c√≥).

T·∫°o file `docker-compose.prod.yml`:

```yaml
version: '3.8'

services:
  # --- CONTROL PLANE API ---
  control-plane:
    container_name: zt-control-plane
    build:
      context: .
      dockerfile: infrastructure/docker/Dockerfile.control
    restart: always
    ports:
      - "${API_PORT:-8000}:8000"
    env_file:
      - .env
    environment:
      - DATABASE_URL=postgresql://${DB_USER}:${DB_PASSWORD}@db:5432/${DB_NAME}
    depends_on:
      db:
        condition: service_healthy
    networks:
      - zt-net

  # --- DATABASE ---
  db:
    container_name: zt-database
    image: postgres:15-alpine
    restart: always
    volumes:
      - postgres_data:/var/lib/postgresql/data
    environment:
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      POSTGRES_DB: ${DB_NAME}
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${DB_USER} -d ${DB_NAME}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - zt-net

volumes:
  postgres_data:

networks:
  zt-net:
    driver: bridge
```

---

### B∆∞·ªõc 2: Vi·∫øt script c√†i ƒë·∫∑t `setup-control-plane.sh`

T·∫°o file `scripts/setup-control-plane.sh` (ho·∫∑c ƒë·ªÉ ngay root). Script n√†y s·∫Ω l√† th·ª© duy nh·∫•t ng∆∞·ªùi d√πng c·∫ßn t·∫£i v·ªÅ v√† ch·∫°y.

```bash
#!/bin/bash

# ==============================================================================
# ZERO TRUST CONTROL PLANE - INSTALLER
# ==============================================================================

set -e

# --- C·∫§U H√åNH ---
INSTALL_DIR="/opt/zero-trust-control-plane"
REPO_URL="https://github.com/maithanhduyan/zero-trust-netwoking.git"
BRANCH="main"

# M√†u s·∫Øc
GREEN='\033[0;32m'
BLUE='\033[0;34m'
RED='\033[0;31m'
NC='\033[0m'

log() { echo -e "${BLUE}[INFO]${NC} $1"; }
success() { echo -e "${GREEN}[OK]${NC} $1"; }
error() { echo -e "${RED}[ERROR]${NC} $1"; exit 1; }

# Ki·ªÉm tra quy·ªÅn Root
if [ "$EUID" -ne 0 ]; then
  error "Vui l√≤ng ch·∫°y script v·ªõi quy·ªÅn root (sudo)."
fi

# 1. C√†i ƒë·∫∑t Docker & Docker Compose (N·∫øu ch∆∞a c√≥)
install_docker() {
    if ! command -v docker &> /dev/null; then
        log "ƒêang c√†i ƒë·∫∑t Docker Engine..."
        curl -fsSL https://get.docker.com | sh
        success "Docker installed."
    else
        log "Docker ƒë√£ ƒë∆∞·ª£c c√†i ƒë·∫∑t."
    fi
}

# 2. Clone ho·∫∑c Pull Code
setup_codebase() {
    if [ -d "$INSTALL_DIR" ]; then
        log "C·∫≠p nh·∫≠t m√£ ngu·ªìn t·∫°i $INSTALL_DIR..."
        cd "$INSTALL_DIR"
        git pull origin $BRANCH
    else
        log "Clone m√£ ngu·ªìn v·ªÅ $INSTALL_DIR..."
        git clone -b $BRANCH $REPO_URL "$INSTALL_DIR"
        cd "$INSTALL_DIR"
    fi
}

# 3. T·∫°o file c·∫•u h√¨nh .env (T·ª± sinh m·∫≠t kh·∫©u)
generate_env() {
    if [ ! -f ".env" ]; then
        log "ƒêang kh·ªüi t·∫°o c·∫•u h√¨nh .env..."
        
        # Sinh m·∫≠t kh·∫©u ng·∫´u nhi√™n
        DB_PASSWORD=$(openssl rand -hex 16)
        SECRET_KEY=$(openssl rand -hex 32)
        
        cat > .env <<EOF
# --- General ---
ENV=production
SECRET_KEY=$SECRET_KEY
API_PORT=8000

# --- Database ---
DB_USER=zt_admin
DB_PASSWORD=$DB_PASSWORD
DB_NAME=zt_control_plane
EOF
        success "ƒê√£ t·∫°o file .env v·ªõi m·∫≠t kh·∫©u ng·∫´u nhi√™n."
    else
        log "File .env ƒë√£ t·ªìn t·∫°i. Gi·ªØ nguy√™n c·∫•u h√¨nh c≈©."
    fi
}

# 4. Ch·∫°y Container
deploy() {
    log "ƒêang build v√† kh·ªüi ƒë·ªông h·ªá th·ªëng..."
    docker compose -f docker-compose.prod.yml up -d --build
    
    # Ch·ªù DB kh·ªüi ƒë·ªông v√† ch·∫°y migration (n·∫øu c√≥ l·ªánh migrate)
    # log "ƒêang ch·∫°y Database Migrations..."
    # docker compose -f docker-compose.prod.yml exec -T control-plane python -m alembic upgrade head
}

# --- MAIN ---
echo "=================================================="
echo "   ZERO TRUST CONTROL PLANE INSTALLER"
echo "=================================================="

install_docker
setup_codebase
generate_env
deploy

echo ""
echo "=================================================="
echo -e "${GREEN}C√ÄI ƒê·∫∂T HO√ÄN T·∫§T!${NC}"
echo "--------------------------------------------------"
echo "API ƒëang ch·∫°y t·∫°i: http://$(curl -s ifconfig.me):8000"
echo "Th∆∞ m·ª•c c√†i ƒë·∫∑t:   $INSTALL_DIR"
echo "Xem logs:          cd $INSTALL_DIR && docker compose -f docker-compose.prod.yml logs -f"
echo "=================================================="
```

---

### B∆∞·ªõc 3: C·∫≠p nh·∫≠t README.md (Tr·∫£i nghi·ªám ng∆∞·ªùi d√πng)

ƒê√¢y l√† b∆∞·ªõc quan tr·ªçng nh·∫•t ƒë·ªÉ ng∆∞·ªùi d√πng bi·∫øt c√°ch c√†i ƒë·∫∑t. B·∫°n h√£y th√™m ƒëo·∫°n n√†y v√†o ƒë·∫ßu file `README.md` tr√™n Github.

```markdown
## üöÄ Quick Start (Production)

C√†i ƒë·∫∑t Control Plane l√™n Ubuntu Server ch·ªâ v·ªõi m·ªôt d√≤ng l·ªánh:

```bash
curl -sSL https://raw.githubusercontent.com/maithanhduyan/zero-trust-netwoking/main/scripts/setup-control-plane.sh | sudo bash
```

**Script n√†y s·∫Ω t·ª± ƒë·ªông:**
1. C√†i ƒë·∫∑t Docker & Docker Compose.
2. Clone m√£ ngu·ªìn v·ªÅ `/opt/zero-trust-control-plane`.
3. T·ª± ƒë·ªông sinh m·∫≠t kh·∫©u Database an to√†n.
4. Kh·ªüi ch·∫°y h·ªá th·ªëng API & Database.
```

---

### B∆∞·ªõc 4: Ki·ªÉm tra v√† Push l√™n Github

1.  ƒê·∫£m b·∫£o file script c√≥ trong git:
    ```bash
    mkdir -p scripts
    # (L∆∞u file setup-control-plane.sh v√†o th∆∞ m·ª•c scripts)
    chmod +x scripts/setup-control-plane.sh
    ```
2.  Push code l√™n Github:
    ```bash
    git add .
    git commit -m "feat: Add production docker-compose and installer script"
    git push origin main
    ```

### T·∫°i sao c√°ch n√†y t·ªët nh·∫•t?

1.  **Kh√¥ng c·∫ßn h∆∞·ªõng d·∫´n d√†i d√≤ng:** Ng∆∞·ªùi d√πng kh√¥ng c·∫ßn bi·∫øt `git clone`, kh√¥ng c·∫ßn bi·∫øt s·ª≠a file `.env`, kh√¥ng c·∫ßn bi·∫øt c√†i Docker. H·ªç ch·ªâ c·∫ßn `curl | bash`.
2.  **B·∫£o m·∫≠t:** Script t·ª± ƒë·ªông sinh m·∫≠t kh·∫©u m·∫°nh (`openssl rand`) thay v√¨ d√πng m·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh "password123".
3.  **Chu·∫©n h√≥a:** M·ªçi server c√†i ƒë·∫∑t theo c√°ch n√†y ƒë·ªÅu c√≥ c·∫•u tr√∫c th∆∞ m·ª•c gi·ªëng h·ªát nhau (`/opt/zero-trust-control-plane`), gi√∫p b·∫°n d·ªÖ d√†ng debug ho·∫∑c vi·∫øt t√†i li·ªáu h∆∞·ªõng d·∫´n sau n√†y.

---

ƒê√¢y l√† ph·∫ßn tri·ªÉn khai chi ti·∫øt m√£ ngu·ªìn (coding) cho **Control Plane**. Ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng **Python (FastAPI + SQLAlchemy)** v√¨ t√≠nh m·∫°nh m·∫Ω, t·ªëc ƒë·ªô cao v√† d·ªÖ d√†ng t√≠ch h·ª£p v·ªõi c√°c logic x·ª≠ l√Ω m·∫°ng.

H·ªá th·ªëng n√†y s·∫Ω th·ª±c hi·ªán 3 nhi·ªám v·ª• c·ªët l√µi c·ªßa m·ªôt Zero Trust Controller:
1.  **IPAM (IP Address Management):** T·ª± ƒë·ªông c·∫•p IP trong d·∫£i `10.0.0.x`.
2.  **Node Registry:** Qu·∫£n l√Ω danh s√°ch c√°c VPS (Peers).
3.  **Policy Engine:** Sinh ra c·∫•u h√¨nh WireGuard v√† lu·∫≠t Firewall (iptables) d·ª±a tr√™n Role.

### 1. C√†i ƒë·∫∑t th∆∞ vi·ªán
T·∫°o file `control-plane/requirements.txt`:

```text
fastapi==0.109.0
uvicorn==0.27.0
sqlalchemy==2.0.25
pydantic==2.5.3
pydantic-settings==2.1.0
```

### 2. Thi·∫øt k·∫ø Database (L∆∞u tr·ªØ tr·∫°ng th√°i)
T·∫°o file `control-plane/database/models.py`. Ch√∫ng ta d√πng SQLite cho ƒë∆°n gi·∫£n (ho·∫∑c Postgres cho production) ƒë·ªÉ l∆∞u Node.

```python
# control-plane/database/models.py
from sqlalchemy import Column, Integer, String, Boolean, DateTime
from sqlalchemy.orm import declarative_base
from datetime import datetime

Base = declarative_base()

class Node(Base):
    __tablename__ = "nodes"

    id = Column(Integer, primary_key=True, index=True)
    hostname = Column(String, unique=True, index=True)
    role = Column(String)  # 'hub', 'app', 'db', 'ops'
    public_key = Column(String, unique=True)
    overlay_ip = Column(String, unique=True) # IP trong m·∫°ng VPN (VD: 10.0.0.2)
    real_ip = Column(String, nullable=True)  # IP Public c·ªßa VPS
    is_active = Column(Boolean, default=False) # Ph·∫£i ƒë∆∞·ª£c approve m·ªõi ch·∫°y
    last_seen = Column(DateTime, default=datetime.utcnow)
```

T·∫°o file `control-plane/database/session.py` ƒë·ªÉ k·∫øt n·ªëi DB:

```python
# control-plane/database/session.py
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from .models import Base

# D√πng SQLite cho d·ªÖ demo, Prod n√™n d√πng PostgreSQL
SQLALCHEMY_DATABASE_URL = "sqlite:///./zerotrust.db"

engine = create_engine(
    SQLALCHEMY_DATABASE_URL, connect_args={"check_same_thread": False}
)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

def init_db():
    Base.metadata.create_all(bind=engine)

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

### 3. ƒê·ªãnh nghƒ©a Data Schema (Pydantic)
T·∫°o file `control-plane/schemas.py` ƒë·ªÉ validate d·ªØ li·ªáu ƒë·∫ßu v√†o/ra c·ªßa API.

```python
# control-plane/schemas.py
from pydantic import BaseModel
from typing import List, Optional
from datetime import datetime

class NodeCreate(BaseModel):
    hostname: str
    role: str
    public_key: str

class NodeResponse(BaseModel):
    id: int
    hostname: str
    role: str
    overlay_ip: str
    is_active: bool
    
    class Config:
        from_attributes = True

class FirewallRule(BaseModel):
    src_ip: str
    port: int
    proto: str = "tcp"
    action: str = "ACCEPT"

class WireGuardConfig(BaseModel):
    node_ip: str
    server_public_key: str
    server_endpoint: str
    allowed_ips: str  # 10.0.0.0/24
    peers: List[dict] # Danh s√°ch peer (n·∫øu mesh)
    acl_rules: List[FirewallRule] # Lu·∫≠t firewall ƒë·ªÉ Agent apply
```

### 4. Policy Engine (B·ªô n√£o Zero Trust)
ƒê√¢y l√† ph·∫ßn quan tr·ªçng nh·∫•t. T·∫°o file `control-plane/core/policy_engine.py`.
Thay v√¨ l∆∞u c·ª©ng trong DB, ta ƒë·ªãnh nghƒ©a **Policy-as-Code** ·ªü ƒë√¢y.

```python
# control-plane/core/policy_engine.py
from typing import List
from schemas import FirewallRule

# ƒê·ªãnh nghƒ©a lu·∫≠t truy c·∫≠p (Intent-based)
# Ai (Source Role) -> ƒê∆∞·ª£c l√†m g√¨ (Port) -> V·ªõi ai (Target Role)
POLICIES = [
    # Odoo (App) ƒë∆∞·ª£c g·ªçi Postgres (DB) qua port 5432
    {"src": "app", "dst": "db", "port": 5432, "proto": "tcp"},
    
    # Ops ƒë∆∞·ª£c SSH v√†o t·∫•t c·∫£ m·ªçi n∆°i
    {"src": "ops", "dst": "*", "port": 22, "proto": "tcp"},
    
    # Ops ƒë∆∞·ª£c truy c·∫≠p monitoring
    {"src": "ops", "dst": "*", "port": 9100, "proto": "tcp"},
]

def generate_acl(target_role: str, all_nodes: list) -> List[FirewallRule]:
    """
    T√≠nh to√°n danh s√°ch IP ƒë∆∞·ª£c ph√©p k·∫øt n·ªëi v√†o Node hi·ªán t·∫°i
    """
    rules = []
    
    for policy in POLICIES:
        # N·∫øu rule √°p d·ª•ng cho role c·ªßa node hi·ªán t·∫°i (ho·∫∑c wildcard *)
        if policy["dst"] == target_role or policy["dst"] == "*":
            
            # T√¨m t·∫•t c·∫£ node c√≥ role l√† ngu·ªìn (src)
            authorized_nodes = [
                n for n in all_nodes 
                if n.role == policy["src"] and n.is_active
            ]
            
            # T·∫°o rule cho t·ª´ng IP
            for node in authorized_nodes:
                rules.append(FirewallRule(
                    src_ip=node.overlay_ip,
                    port=policy["port"],
                    proto=policy["proto"]
                ))
                
    return rules
```

### 5. Logic qu·∫£n l√Ω Node & IPAM
T·∫°o file `control-plane/core/node_manager.py`.

```python
# control-plane/core/node_manager.py
from sqlalchemy.orm import Session
from database.models import Node
import schemas
import ipaddress

# C·∫•u h√¨nh m·∫°ng Overlay
NETWORK_CIDR = "10.0.0.0/24"
SERVER_IP = "10.0.0.1"
SERVER_PUBLIC_KEY = "SERVER_WG_PUBLIC_KEY_PLACEHOLDER" # Thay b·∫±ng key th·∫≠t c·ªßa VPS-1
SERVER_ENDPOINT = "vps1.domain.com:51820" # Thay b·∫±ng IP/Domain th·∫≠t

def get_next_ip(db: Session):
    """C·∫•p ph√°t IP ti·∫øp theo ch∆∞a s·ª≠ d·ª•ng"""
    used_ips = [n.overlay_ip for n in db.query(Node).all()]
    network = ipaddress.IPv4Network(NETWORK_CIDR)
    
    # B·ªè qua .0 (network), .1 (gateway/hub), .255 (broadcast)
    for ip in network.hosts():
        ip_str = str(ip)
        if ip_str == SERVER_IP: continue
        if ip_str not in used_ips:
            return ip_str
    raise Exception("Network exhausted")

def register_node(db: Session, node_in: schemas.NodeCreate):
    # Ki·ªÉm tra xem hostname ho·∫∑c key ƒë√£ t·ªìn t·∫°i ch∆∞a
    existing = db.query(Node).filter(
        (Node.hostname == node_in.hostname) | (Node.public_key == node_in.public_key)
    ).first()
    
    if existing:
        return existing

    # C·∫•p IP m·ªõi
    new_ip = get_next_ip(db)
    
    # M·∫∑c ƒë·ªãnh auto-approve cho Ops, c√°c role kh√°c ph·∫£i ƒë·ª£i (ho·∫∑c auto cho demo)
    is_active = True 
    
    db_node = Node(
        hostname=node_in.hostname,
        role=node_in.role,
        public_key=node_in.public_key,
        overlay_ip=new_ip,
        is_active=is_active
    )
    db.add(db_node)
    db.commit()
    db.refresh(db_node)
    return db_node
```

### 6. API Endpoints
T·∫°o file `control-plane/api.py`.

```python
# control-plane/api.py
from fastapi import FastAPI, Depends, HTTPException, Request
from sqlalchemy.orm import Session
from database import session, models
from core import node_manager, policy_engine
import schemas

# Kh·ªüi t·∫°o DB
session.init_db()

app = FastAPI(title="Zero Trust Control Plane")

@app.post("/register", response_model=schemas.NodeResponse)
def register(node: schemas.NodeCreate, db: Session = Depends(session.get_db)):
    """Agent g·ªçi endpoint n√†y l·∫ßn ƒë·∫ßu ƒë·ªÉ l·∫•y Overlay IP"""
    return node_manager.register_node(db, node)

@app.get("/config/{hostname}", response_model=schemas.WireGuardConfig)
def get_config(hostname: str, request: Request, db: Session = Depends(session.get_db)):
    """
    Agent g·ªçi endpoint n√†y ƒë·ªãnh k·ª≥ ƒë·ªÉ:
    1. C·∫≠p nh·∫≠t Real IP (Heartbeat)
    2. L·∫•y danh s√°ch ACL m·ªõi nh·∫•t
    """
    node = db.query(models.Node).filter(models.Node.hostname == hostname).first()
    if not node:
        raise HTTPException(status_code=404, detail="Node not found")
    
    if not node.is_active:
        raise HTTPException(status_code=403, detail="Node pending approval")

    # 1. Update Heartbeat & Real IP
    node.real_ip = request.client.host
    node.last_seen = datetime.utcnow()
    db.commit()

    # 2. T√≠nh to√°n ACL Rules d·ª±a tr√™n Role
    all_nodes = db.query(models.Node).all()
    acl_rules = policy_engine.generate_acl(node.role, all_nodes)

    # 3. Tr·∫£ v·ªÅ c·∫•u h√¨nh
    return schemas.WireGuardConfig(
        node_ip=node.overlay_ip,
        server_public_key=node_manager.SERVER_PUBLIC_KEY,
        server_endpoint=node_manager.SERVER_ENDPOINT,
        allowed_ips="10.0.0.0/24", # Route to√†n b·ªô VPN traffic qua Hub
        peers=[], # Trong m√¥ h√¨nh Hub-and-Spoke, Agent ch·ªâ c·∫ßn peer v·ªõi Hub
        acl_rules=acl_rules
    )
```

### 7. Entry Point
T·∫°o file `control-plane/main.py`.

```python
# control-plane/main.py
import uvicorn
from api import app

if __name__ == "__main__":
    # Ch·∫°y server t·∫°i port 8000
    uvicorn.run("main:app", host="0.0.0.0", port=8000, reload=True)
```

---

### H∆∞·ªõng d·∫´n ch·∫°y th·ª≠ Control Plane

1.  **V√†o th∆∞ m·ª•c:**
    ```bash
    cd control-plane
    ```

2.  **C√†i dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

3.  **C·∫•u h√¨nh bi·∫øn m√¥i tr∆∞·ªùng:**
    M·ªü `core/node_manager.py` v√† s·ª≠a `SERVER_PUBLIC_KEY` b·∫±ng public key WireGuard th·∫≠t tr√™n VPS-1 (l·∫•y b·∫±ng l·ªánh `wg show wg0 public-key`).

4.  **Ch·∫°y server:**
    ```bash
    python3 main.py
    ```

### Ki·ªÉm th·ª≠ Logic Zero Trust

Gi·∫£ s·ª≠ b·∫°n c√≥ 2 node ƒëƒÉng k√Ω: `odoo-1` (Role: app) v√† `postgres-1` (Role: db).

**B∆∞·ªõc 1: ƒêƒÉng k√Ω Odoo**
```bash
curl -X POST http://localhost:8000/register \
-H "Content-Type: application/json" \
-d '{"hostname": "odoo-1", "role": "app", "public_key": "KEY_A..."}'
```
*K·∫øt qu·∫£:* ƒê∆∞·ª£c c·∫•p IP `10.0.0.2`.

**B∆∞·ªõc 2: ƒêƒÉng k√Ω Postgres**
```bash
curl -X POST http://localhost:8000/register \
-H "Content-Type: application/json" \
-d '{"hostname": "postgres-1", "role": "db", "public_key": "KEY_B..."}'
```
*K·∫øt qu·∫£:* ƒê∆∞·ª£c c·∫•p IP `10.0.0.3`.

**B∆∞·ªõc 3: Postgres l·∫•y Config (ACL)**
```bash
curl http://localhost:8000/config/postgres-1
```
*K·∫øt qu·∫£ tr·∫£ v·ªÅ (JSON):*
```json
{
  "node_ip": "10.0.0.3",
  "acl_rules": [
    {
      "src_ip": "10.0.0.2",
      "port": 5432,
      "proto": "tcp",
      "action": "ACCEPT"
    }
  ]
}
```
**Ph√¢n t√≠ch:** Control Plane ƒë√£ t·ª± ƒë·ªông bi·∫øt r·∫±ng `postgres-1` l√† DB, n√™n n√≥ t·∫°o rule cho ph√©p `10.0.0.2` (Odoo) truy c·∫≠p port 5432. N√≥ **KH√îNG** t·∫°o rule cho ph√©p SSH (port 22) v√¨ trong Policy kh√¥ng ƒë·ªãnh nghƒ©a.

ƒê√¢y ch√≠nh l√† c·ªët l√µi c·ªßa **Dynamic Zero Trust Control Plane**: B·∫°n thay ƒë·ªïi Policy ·ªü server, t·∫•t c·∫£ firewall ·ªü client t·ª± ƒë·ªông c·∫≠p nh·∫≠t theo l·∫ßn sync ti·∫øp theo.

---

Quy·∫øt ƒë·ªãnh tuy·ªát v·ªùi. `uv` (c·ªßa Astral) nhanh h∆°n `pip` t·ª´ 10-100 l·∫ßn v√† h·ªó tr·ª£ qu·∫£n l√Ω d·ª± √°n (Project Management) v·ªõi file `pyproject.toml` r·∫•t chu·∫©n ch·ªâ, thay v√¨ d√πng `requirements.txt` r·ªùi r·∫°c.

V·ªõi c·∫•u tr√∫c Monorepo (Control Plane + Agent), ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng t√≠nh nƒÉng **Workspaces** c·ªßa `uv` ƒë·ªÉ qu·∫£n l√Ω c·∫£ hai trong m·ªôt d·ª± √°n duy nh·∫•t.

D∆∞·ªõi ƒë√¢y l√† c√°c b∆∞·ªõc chuy·ªÉn ƒë·ªïi to√†n b·ªô d·ª± √°n sang `uv`.

### 1. C·∫•u tr√∫c th∆∞ m·ª•c m·ªõi (v·ªõi `uv`)

Thay v√¨ `requirements.txt`, ch√∫ng ta s·∫Ω c√≥ `pyproject.toml` ·ªü root v√† t·ª´ng th∆∞ m·ª•c con.

```text
zero-trust-networking/
‚îú‚îÄ‚îÄ pyproject.toml           # (ROOT) ƒê·ªãnh nghƒ©a Workspace
‚îú‚îÄ‚îÄ uv.lock                  # (ROOT) Kh√≥a phi√™n b·∫£n cho to√†n b·ªô d·ª± √°n (B·∫¢O M·∫¨T)
‚îÇ
‚îú‚îÄ‚îÄ control-plane/
‚îÇ   ‚îú‚îÄ‚îÄ pyproject.toml       # Dependencies ri√™ng c·ªßa Control Plane
‚îÇ   ‚îî‚îÄ‚îÄ src/                 # (Khuy√™n d√πng src layout cho chu·∫©n)
‚îÇ       ‚îî‚îÄ‚îÄ main.py
‚îÇ
‚îú‚îÄ‚îÄ agent/
‚îÇ   ‚îú‚îÄ‚îÄ pyproject.toml       # Dependencies ri√™ng c·ªßa Agent
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îî‚îÄ‚îÄ agent.py
‚îÇ
‚îî‚îÄ‚îÄ infrastructure/
    ‚îî‚îÄ‚îÄ docker/
        ‚îî‚îÄ‚îÄ Dockerfile.control # Dockerfile t·ªëi ∆∞u cho uv
```

---

### 2. Thi·∫øt l·∫≠p Workspace

B·∫°n ch·∫°y c√°c l·ªánh sau t·∫°i th∆∞ m·ª•c g·ªëc c·ªßa d·ª± √°n ƒë·ªÉ kh·ªüi t·∫°o:

```bash
# 1. C√†i ƒë·∫∑t uv (n·∫øu ch∆∞a c√≥)
curl -LsSf https://astral.sh/uv/install.sh | sh

# 2. Kh·ªüi t·∫°o d·ª± √°n g·ªëc
uv init --app --name zero-trust-networking
# (X√≥a file hello.py m·∫∑c ƒë·ªãnh n·∫øu c√≥)

# 3. S·ª≠a file pyproject.toml ·ªü root ƒë·ªÉ khai b√°o workspace
```

**N·ªôi dung `pyproject.toml` (G·ªëc):**

```toml
[project]
name = "zero-trust-networking"
version = "0.1.0"
description = "Zero Trust Architecture Control Plane & Agent"
requires-python = ">=3.10"
dependencies = []

[tool.uv]
# Khai b√°o c√°c th√†nh vi√™n trong workspace
members = ["control-plane", "agent"]
```

---

### 3. C·∫•u h√¨nh Dependencies cho t·ª´ng module

#### A. Control Plane
Thay v√¨ t·∫°o file text, ta t·∫°o `pyproject.toml` trong `control-plane/`.

**N·ªôi dung `control-plane/pyproject.toml`:**

```toml
[project]
name = "control-plane"
version = "0.1.0"
description = "The Brain of Zero Trust"
requires-python = ">=3.10"
dependencies = [
    "fastapi>=0.109.0",
    "uvicorn>=0.27.0",
    "sqlalchemy>=2.0.25",
    "pydantic>=2.5.3",
    "pydantic-settings>=2.1.0",
    "psycopg2-binary>=2.9.9",
    "alembic>=1.13.1"
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"
```

#### B. Agent
T∆∞∆°ng t·ª± cho Agent.

**N·ªôi dung `agent/pyproject.toml`:**

```toml
[project]
name = "zt-agent"
version = "0.1.0"
description = "The Muscle of Zero Trust"
requires-python = ">=3.10"
dependencies = [
    "requests>=2.31.0",
    "schedule>=1.2.1",
    "psutil>=5.9.8",
    "netifaces>=0.11.0"
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"
```

---

### 4. C·∫≠p nh·∫≠t `Dockerfile` (T·ªëi ∆∞u Cache c·ª±c m·∫°nh)

ƒê√¢y l√† n∆°i `uv` t·ªèa s√°ng. Ch√∫ng ta s·ª≠ d·ª•ng **Multi-stage build** ƒë·ªÉ cache dependencies. Docker s·∫Ω kh√¥ng ph·∫£i t·∫£i l·∫°i th∆∞ vi·ªán n·∫øu code thay ƒë·ªïi, ch·ªâ t·∫£i l·∫°i khi `uv.lock` thay ƒë·ªïi.

**File: `infrastructure/docker/Dockerfile.control`**

```dockerfile
# --- STAGE 1: Builder (C√†i ƒë·∫∑t dependencies) ---
FROM ghcr.io/astral-sh/uv:python3.10-bookworm-slim AS builder

WORKDIR /app

# Enable bytecode compilation
ENV UV_COMPILE_BYTECODE=1
# Copy c√°c file ƒë·ªãnh nghƒ©a dependencies tr∆∞·ªõc
COPY pyproject.toml uv.lock ./
COPY control-plane/pyproject.toml ./control-plane/
COPY agent/pyproject.toml ./agent/

# ƒê·ªìng b·ªô dependencies (ch∆∞a c·∫ßn source code)
# L·ªánh n√†y s·∫Ω t·∫°o virtualenv t·∫°i .venv
RUN uv sync --frozen --no-install-project

# --- STAGE 2: Runtime (Ch·∫°y ·ª©ng d·ª•ng) ---
FROM python:3.10-slim-bookworm

WORKDIR /app

# Copy m√¥i tr∆∞·ªùng ·∫£o t·ª´ builder sang
COPY --from=builder /app/.venv /app/.venv

# ƒê·∫∑t ƒë∆∞·ªùng d·∫´n ƒë·ªÉ d√πng python trong venv m·∫∑c ƒë·ªãnh
ENV PATH="/app/.venv/bin:$PATH"

# Copy source code
COPY control-plane ./control-plane

# Chuy·ªÉn v√†o th∆∞ m·ª•c l√†m vi·ªác
WORKDIR /app/control-plane

# Ch·∫°y server
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

---

### 5. C·∫≠p nh·∫≠t script `install.sh` (Cho Dev Environment)

Ch√∫ng ta s·ª≠a l·∫°i script c√†i ƒë·∫∑t ƒë·ªÉ d√πng `uv sync` thay v√¨ `pip install`.

```bash
#!/bin/bash

# ==============================================================================
#  ZERO TRUST PROJECT SCAFFOLDING (UV EDITION)
# ==============================================================================

set -e
PROJECT_NAME="zero-trust-networking"

# ... (Gi·ªØ nguy√™n c√°c ph·∫ßn t·∫°o th∆∞ m·ª•c c≈©) ...

log "0. C√†i ƒë·∫∑t uv..."
if ! command -v uv &> /dev/null; then
    curl -LsSf https://astral.sh/uv/install.sh | sh
    source $HOME/.cargo/env
fi

mkdir -p "$PROJECT_NAME"
cd "$PROJECT_NAME"

# --- T·∫†O FILE PYPROJECT.TOML ---
log "1. Kh·ªüi t·∫°o Workspace..."
cat > pyproject.toml <<EOF
[project]
name = "zero-trust-networking"
version = "0.1.0"
requires-python = ">=3.10"
dependencies = []

[tool.uv]
members = ["control-plane", "agent"]
EOF

# --- CONTROL PLANE SETUP ---
log "2. Setup Control Plane..."
mkdir -p control-plane
cat > control-plane/pyproject.toml <<EOF
[project]
name = "control-plane"
version = "0.1.0"
requires-python = ">=3.10"
dependencies = [
    "fastapi",
    "uvicorn",
    "sqlalchemy",
    "pydantic",
    "psycopg2-binary"
]
[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"
EOF

# --- AGENT SETUP ---
log "3. Setup Agent..."
mkdir -p agent
cat > agent/pyproject.toml <<EOF
[project]
name = "zt-agent"
version = "0.1.0"
requires-python = ">=3.10"
dependencies = [
    "requests",
    "schedule"
]
[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"
EOF

# --- C√ÄI ƒê·∫∂T ---
log "4. Installing dependencies with uv..."
uv sync

success "Ho√†n t·∫•t! M√¥i tr∆∞·ªùng ·∫£o ƒë√£ ƒë∆∞·ª£c t·∫°o t·∫°i .venv"
echo "ƒê·ªÉ k√≠ch ho·∫°t: source .venv/bin/activate"
```

### 6. Workflow l√†m vi·ªác h√†ng ng√†y (Cheat Sheet)

Khi d√πng `uv`, quy tr√¨nh c·ªßa b·∫°n s·∫Ω nh∆∞ sau:

1.  **Th√™m th∆∞ vi·ªán m·ªõi cho Control Plane:**
    ```bash
    # Thay v√¨ pip install requests
    uv add requests --package control-plane
    ```
    *L·ªánh n√†y t·ª± ƒë·ªông c·∫≠p nh·∫≠t `control-plane/pyproject.toml` v√† `uv.lock` ·ªü root.*

2.  **Ch·∫°y Control Plane (Dev):**
    ```bash
    # Kh√¥ng c·∫ßn activate venv th·ªß c√¥ng
    uv run --package control-plane uvicorn main:app --reload
    ```

3.  **ƒê·ªìng b·ªô m√¥i tr∆∞·ªùng (khi pull code v·ªÅ):**
    ```bash
    uv sync
    ```

### T·∫°i sao thay ƒë·ªïi n√†y quan tr·ªçng cho d·ª± √°n c·ªßa b·∫°n?
V·ªõi Zero Trust, **t√≠nh nh·∫•t qu√°n (Consistency)** l√† quan tr·ªçng nh·∫•t.
*   `pip` kh√¥ng c√≥ lockfile m·∫∑c ƒë·ªãnh -> M·ªói l·∫ßn c√†i tr√™n VPS kh√°c nhau c√≥ th·ªÉ ra phi√™n b·∫£n ph·ª• kh√°c nhau -> Bug ti·ªÅm ·∫©n.
*   `uv.lock` ƒë·∫£m b·∫£o VPS 1, VPS 4 v√† M√°y Dev c·ªßa b·∫°n ch·∫°y **ch√≠nh x√°c t·ª´ng byte** c·ªßa c√πng m·ªôt phi√™n b·∫£n th∆∞ vi·ªán.

---